---
title: "l1svr: An R Package for Support Vector Regression under l1 Regularization"
author: "Yuehao Bai, Hung Ho, Guillaume Pouliot, and Joshua Shea"
bibliography: l1svr.bib
output:
  html_document:
    toc: true
    keep_md: true
  github_document:
    toc: true
    keep_html: true
vignette: >
  %\VignetteIndexEntry{ivmte}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  cache = TRUE
)
```

## Introduction

The **l1svr** package allows the user to estimate and perform statistical inference for support vector regressions under l1 regularization ($\ell_1$-SVR).
This vignette documents package installation and requirements, and demonstrates how the package may be used.
A brief overview of the $\ell_1$-SVR estimation problem is also provided.
We refer the reader to @bai2021inference for technical details on how the estimation and inference are carried out.

## Installation and Requirements

**l1svr** can be installed from CRAN via
```{r eval = FALSE}
install.packages("l1svr")
```

If you have the **devtools** package, you can install the latest version of the module directly from our GitHub repository via
```{r eval = FALSE}
devtools::install_github("jkcshea/l1svr")
```

A package for solving linear programs is required.
Currently, the package only suports Gurobi.
This requires a Gurobi software license, which Gurobi Optimization offers at no cost to academic researchers.
Gurobi and its R package **gurobi** can be optained from [Gurobi Optimization](http://www.gurobi.com/index).
A very clear installation guide for Gurobi can be found [here](https://cran.r-project.org/package=prioritizr/vignettes/gurobi_installation.html)

<!--
    i. The **lpSolveAPI** package, which is free and open-source, and available from CRAN.
    Note that **lpSolveAPI** is a wrapper for [lp_solve](http://lpsolve.sourceforge.net/5.5/), which is no longer
    actively developed.
-->

## Background

TALK ABOUT THE SETUP, $\epsilon$ and $\lambda$.

## Usage Demonstration

```{r, load-package, include = FALSE}
source('svr-clean-alt.R')
```

```{r, gen-data, include = FALSE}
library(MASS)
set.seed(10L)
n <- 500
mu <- c(1, 2)
Sigma <- matrix(c(1, -2, 3, 2), nrow = 2)
Sigma <- Sigma %*% t(Sigma)
sdMat <- diag(1/sqrt(diag(Sigma)))
corrMat <- sdMat %*% Sigma %*% sdMat
beta <- c(-2, 1, 0.5)
X <- as.matrix(mvrnorm(n = n, mu = mu, Sigma = Sigma))
x <- cbind(1, X)
u <- rnorm(n, 0, 12)
y <- x[, 1:3] %*% beta + u
simdata <- data.frame(cbind(y, x[, -1]))
colnames(simdata) <- c('y', 'x1', 'x2')
```

The package includes the data set `simdata`, which we will use to demonstrate how the package may be used.

```{r, show-data}
knitr::kable(head(simdata))
```

The data generating process is
$$ Y = -2 + X_1 + 0.5 X_2 + 12 \Phi^{-1}(\tau)$$
where
$$
\begin{align*}
X &\sim N
\left(
\left[
\begin{array}{c}
1 \\
2
\end{array}
\right],
\left[
\begin{array}{cc}
10 & 4 \\
4 & 8
\end{array}
\right]
\right), \\
\tau &\sim \text{Unif}([0, 0.4] \cup [0.6, 1]),
\end{align*}
$$
and $\Phi^{-1}$ is the inverse CDF of a standard normal distribution.
Note the error term $12 \Phi^{-1}(\tau)$ follows a normal distribution with its middle quitinle removed.
The restriction of the support may be thought of as an extreme version of the data generating process which SVR is meant for when conceived as a regression extension of SVM classification.

The regression and inference may be performed by passing a data set, a regression equation, a bandwidth $\epsilon$, and a penalty $\lambda$ to the function `l1svr`.

```{r, basic-demo}
fit1 <- l1svr(formula = y ~ 1 + x1 + x2,
              data = simdata,
              epsilon = 7,
              lambda = 20)
summary(fit1)
```

The coefficient estimates are stored in the entry `$coefficients` of the output.

By default, statistical inference is performed and the errors are assumed to be homoskedastic.
Inference for heteroskedastic errors may be performed by setting `heteroskedastic = TRUE`.
This requires an estimate of the density of the errors, which is obtained using the procedure described in @powell1991estimation.
This requires the user to pass two postiive scalar tuning parameters, `h` and `k`, which determine the bandwidth used for the density estimation,
$$
\kappa \left( \Phi^{-1}(0.5 + hn^{-\frac{1}{3}} - \Phi^{-1}(0.5 - hn^{-\frac{1}{3}} \right),
$$
where $n$ denotes the sample size.

```{r, hetero-demo}
fit2 <- l1svr(formula = y ~ 1 + x1 + x2,
              data = simdata,
              epsilon = 7,
              lambda = 20,
              heteroskedastic = TRUE,
              h = 2,
              kappa = 1.75)
summary(fit2)
```

The $p$-values are stored in the entry `$pvalues' of the output.

If desired, the user may turn off the inference procedure by setting `inference = FALSE`.

## Additional output

TALK ABOUT THE OTHER THINGS THAT ARE RETURNED.

## Help, Feature Requests and Bug Reports

Please post an issue on the [GitHub repository](https://github.com/jkcshea/l1svr/issues).

## References
